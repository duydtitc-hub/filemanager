<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Album Manager — Standalone</title>
    <script>
      // Set this to your running Flask server (including protocol and port).
      // Example: 'http://127.0.0.1:5000' or 'http://localhost:5000'
      // Leave empty to use same-origin when served from the Flask app.
      window.APP_HOST = 'https://sandbox.travel.com.vn/file';
    </script>
    <style>
      .breadcrumb-row{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    </style>
    <link rel="stylesheet" href="style.css">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-" crossorigin="anonymous">
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Album Manager</a>
        <div>
          <button id="toggleFormsBtn" class="btn btn-outline-light me-2">Forms</button>
          <button id="openFormsPage" class="btn btn-light">Open Forms Page</button>
        </div>
      </div>
    </nav>
    <main>
      <div class="breadcrumb-row">
        <button id="btnUp" class="btn btn-outline btn-up" title="Quay lên thư mục trên">Quay lên</button>
        <div id="breadcrumb" class="breadcrumb-text"></div>
        <button type="button" id="btnDeleteSelected" class="btn btn-danger">Xóa chọn</button>
      </div>

      <div class="controls">
        <form id="createAlbumForm">
          <input type="text" name="name" placeholder="Tên album mới" required>
          <button type="submit" class="btn btn-primary">Tạo album</button>
        </form>

        <form id="uploadForm" enctype="multipart/form-data">
          <input type="file" id="uploadFiles" name="files" multiple>
          <button type="submit" class="btn btn-primary">Upload</button>
        </form>

        <form id="searchForm">
          <input type="search" id="searchInput" name="q" placeholder="Tìm theo tên file hoặc album">
          <button type="submit" class="btn btn-primary">Tìm</button>
          <button type="button" id="clearSearch" class="btn btn-secondary">Bỏ tìm</button>
        </form>
        <label for="filterSelect">Lọc:</label>
        <select id="filterSelect">
          <option value="all">Tất cả</option>
          <option value="image">Chỉ ảnh</option>
          <option value="video">Chỉ video</option>
          <option value="other">Chỉ file khác</option>
        </select>

        <label for="sortSelect">Sắp xếp:</label>
        <select id="sortSelect">
          <option value="newest">Mới nhất</option>
          <option value="oldest">Cũ nhất</option>
          <option value="name_asc">Tên A→Z</option>
          <option value="name_desc">Tên Z→A</option>
          <option value="type">Theo loại</option>
        </select>
      </div>

      <!-- Forms panel (hidden by default, Bootstrap-styled) -->
      <section id="formsPanel" class="forms-panel container my-3" style="display:none">
        <div class="card p-3">
          <h4>Gửi tác vụ / Công cụ</h4>
          <div class="row g-3">
            <div class="col-md-6">
              <form id="videoTaskForm" class="tool-form">
                <h5>Tạo tác vụ video</h5>
                <div class="mb-2"><input class="form-control" type="text" name="video_urls" placeholder="Video URL(s) - cách nhau bằng dấu phẩy hoặc xuống dòng"></div>
                <div class="mb-2"><input class="form-control" type="text" name="story_url" placeholder="Story URL (bắt buộc)" required></div>
                <div class="mb-2"><input class="form-control" type="text" name="story_name" placeholder="Tiêu đề (sẽ gửi dưới tên 'title') (tùy chọn)"></div>
                <div class="mb-2"><input class="form-control tag-input" type="text" name="tiktok_tags" placeholder="Tags (phân tách bằng dấu phẩy)"></div>
                <div class="mb-2">
                  <label class="form-label">Background (bgaudio)</label>
                  <select class="form-select" name="bg_choice">
                    <option value="">-- None --</option>
                  </select>
                </div>
                <div class="mb-2"><label class="form-label">Part duration (seconds)</label><input class="form-control" type="number" name="part_duration" value="3600" min="1"></div>
                <div class="mb-2"><label class="form-label">Start from part</label><input class="form-control" type="number" name="start_from_part" value="1" min="1"></div>
                <div class="mb-2"><label class="form-label">Parts (optional, comma separated)</label><input class="form-control" type="text" name="parts" placeholder="1,3,5"></div>
                <div class="mb-2">
                  <label class="form-label">Voice</label>
                  <select class="form-select" name="voice">
                    <option value="gfemale">gfemale</option>
                    <option value="gman">gman</option>
                    <option value="nova">nova</option>
                    <option value="echo">echo</option>
                  </select>
                </div>
                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" name="include_summary" checked><label class="form-check-label">Gồm tóm tắt</label></div>
                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" name="refresh_audio"><label class="form-check-label">Refresh audio (tạo lại audio)</label></div>
                <div class="mt-2"><button type="submit" class="btn btn-primary">Gửi tác vụ</button></div>
              </form>
            </div>

            <div class="col-md-6">
              <form id="clearCacheForm" class="tool-form">
                <h5>Xóa cache truyện</h5>
                <div class="mb-2"><input class="form-control" type="text" name="story_url" placeholder="Story URL" required></div>
                <div class="mb-2">
                  <label class="form-label">Giữ video cache</label>
                  <select class="form-select" id="preserve_cache" name="preserve_video_cache">
                    <option value="true">True</option>
                    <option value="false">False</option>
                  </select>
                </div>
                <div><button type="submit" class="btn btn-secondary">Xóa cache</button></div>
              </form>
            </div>

            <div class="col-md-6">
              <form id="processSeriesForm" class="tool-form">
                <h5>Process Series</h5>
                <div class="mb-2"><input class="form-control" type="text" name="start_url" placeholder="Start URL (tập 1)" required></div>
                <div class="mb-2"><input class="form-control" type="text" name="titles" placeholder="Tiêu đề (tùy chọn)"></div>
                <div class="mb-2"><input class="form-control" type="number" name="max_episodes" placeholder="Số tập tối đa" min="1"></div>
                <div class="mb-2"><input class="form-control" type="text" name="render_mode" placeholder="Render mode (0/1/2)"></div>
                <div class="mb-2">
                  <label class="form-label">Voice</label>
                  <select class="form-select" name="voice">
                    <option value="gfemale">gfemale</option>
                    <option value="gman">gman</option>
                    <option value="nova">nova</option>
                    <option value="echo">echo</option>
                  </select>
                </div>
                <div><button type="submit" class="btn btn-primary">Bắt đầu</button></div>
              </form>
            </div>

            <div class="col-md-6">
              <form id="checkTaskForm" class="tool-form">
                <h5>Check Task Status</h5>
                <div class="mb-2"><input class="form-control" type="text" name="task_id" placeholder="Task ID" required></div>
                <div><button type="submit" class="btn btn-outline-primary">Check</button></div>
              </form>

              <form id="renameForm" class="tool-form mt-3">
                <h5>Rename Path</h5>
                <div class="mb-2"><input class="form-control" type="text" name="old" placeholder="Old path (relative)" required></div>
                <div class="mb-2"><input class="form-control" type="text" name="new" placeholder="New path (relative)" required></div>
                <div><button type="submit" class="btn btn-outline-danger">Rename</button></div>
              </form>

              <form id="deletePathForm" class="tool-form mt-3">
                <h5>Delete Path</h5>
                <div class="mb-2"><input class="form-control" type="text" name="path" placeholder="Path to delete (relative)" required></div>
                <div><button type="submit" class="btn btn-danger">Delete</button></div>
              </form>
            </div>

            <div class="col-12">
              <div id="taskPanel" class="mt-3"></div>
              <div id="formsResponse" class="mt-3 alert alert-secondary" role="alert">Chưa có phản hồi.</div>
            </div>
          </div>
        </div>
      </section>

      <section id="folders"></section>
      <section id="files" class="grid"></section>
    </main>

    <!-- Modal player for video/image preview -->
    <div id="playerModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <button id="modalClose" class="modal-close" aria-label="Close">×</button>
        <div id="modalMedia" class="modal-media">
          <video id="modalVideo" controls playsinline preload="metadata" style="max-width:100%; display:none"></video>
          <img id="modalImage" style="max-width:100%; display:none" />
          <audio id="modalAudio" controls style="width:100%; display:none"></audio>
        </div>
        <div class="modal-actions">
          <a id="modalDownload" class="btn" href="#" download>Download</a>
        </div>
      </div>
    </div>

    <!-- Tagify (suggestions + create) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css">
    <style>
      /* Make Tagify inputs visually match Bootstrap 5 form controls */
      .tagify{ display:block; width:100%; }
      .tagify__input { min-height: calc(1.5em + 0.75rem); padding: .375rem .75rem; margin: 0; }
      .tagify__tag { border-radius: .375rem; background-color: rgba(0,0,0,0.05); padding: .25rem .5rem; margin-right: .25rem; }
      .tagify__input:focus{ outline: none; box-shadow: none }
      /* Ensure Tagify dropdown aligns with inputs */
      .tagify__dropdown{ z-index: 2000 }
      .recent-tags{ margin-top:6px; display:flex; flex-wrap:wrap; gap:6px }
      .recent-tags .recent-tag-btn{ padding: .25rem .5rem; font-size: .825rem }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.min.js"></script>
    <script src="app.js"></script>
    <!-- Tagify initialization moved to app.js to avoid duplication -->
    <!-- Floating dashboard panel -->
    <button id="openDashboardFab" class="fab btn btn-primary" title="Tasks">⚡</button>
    <div id="taskDashboardPanel" aria-hidden="true">
      <div class="panel-header">
        <h4>Task Dashboard</h4>
        <button id="closeDashboard" class="panel-close">✕</button>
      </div>
      <div id="taskDashboard" style="min-height:40px">Đang chờ kết nối...</div>
    </div>
  </body>
</html>
